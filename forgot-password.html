<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - Project Conductor</title>
    <meta name="description" content="Reset your Project Conductor password">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¯</text></svg>">

    <!-- Styles -->
    <link rel="stylesheet" href="/public/css/auth.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <!-- Back Link -->
            <a href="login.html" class="back-link">Back to Sign In</a>

            <!-- Logo and Branding -->
            <div class="auth-logo">
                <h1>Project Conductor</h1>
                <p>Document-Anchored Orchestration Platform</p>
            </div>

            <h2>Reset Password</h2>

            <p style="color: #718096; text-align: center; margin-bottom: 24px; font-size: 14px;">
                Enter your email address and we'll send you instructions to reset your password.
            </p>

            <!-- Success Checkmark (hidden by default) -->
            <div id="successCheckmark" class="success-checkmark">
                <svg viewBox="0 0 52 52">
                    <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                    <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
            </div>

            <!-- Success Message (hidden by default) -->
            <div id="successMessage" style="display: none; text-align: center;">
                <h3 style="color: #48bb78; margin-bottom: 12px;">Check Your Email</h3>
                <p style="color: #718096; font-size: 14px; line-height: 1.6;">
                    If an account exists with <strong id="submittedEmail"></strong>,
                    you will receive password reset instructions.
                </p>
                <div style="margin-top: 24px;">
                    <a href="login.html" class="auth-button" style="text-decoration: none; display: inline-block; padding: 12px 24px;">
                        Return to Sign In
                    </a>
                </div>
            </div>

            <!-- Global Message (Error/Info) -->
            <div id="globalMessage" class="message"></div>

            <!-- Forgot Password Form -->
            <form id="forgotPasswordForm" class="auth-form" novalidate>
                <!-- Email Field -->
                <div class="form-group">
                    <label for="email" class="required">Email Address</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        placeholder="you@company.com"
                        autocomplete="email"
                        required
                        autofocus
                    >
                    <span class="field-error" id="emailError"></span>
                </div>

                <!-- Submit Button -->
                <button type="submit" id="submitButton">
                    Send Reset Instructions
                </button>

                <!-- Info Message -->
                <div class="message info show" style="margin-top: 16px; font-size: 13px;">
                    Password reset functionality is currently being implemented.
                    Please contact your administrator for assistance.
                </div>
            </form>
        </div>
    </div>

    <!-- Forgot Password Script -->
    <script>
        // Form elements
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        const emailInput = document.getElementById('email');
        const submitButton = document.getElementById('submitButton');
        const globalMessage = document.getElementById('globalMessage');
        const successMessage = document.getElementById('successMessage');
        const successCheckmark = document.getElementById('successCheckmark');
        const submittedEmail = document.getElementById('submittedEmail');

        // Error message element
        const emailError = document.getElementById('emailError');

        /**
         * Show global message
         */
        function showMessage(message, type = 'error') {
            globalMessage.textContent = message;
            globalMessage.className = `message ${type} show`;
        }

        /**
         * Hide global message
         */
        function hideMessage() {
            globalMessage.classList.remove('show');
        }

        /**
         * Show field error
         */
        function showFieldError(element, errorElement, message) {
            element.classList.add('error');
            element.classList.remove('success');
            errorElement.textContent = message;
            errorElement.classList.add('show');
        }

        /**
         * Clear field error
         */
        function clearFieldError(element, errorElement) {
            element.classList.remove('error');
            errorElement.textContent = '';
            errorElement.classList.remove('show');
        }

        /**
         * Mark field as valid
         */
        function markFieldValid(element) {
            element.classList.remove('error');
            element.classList.add('success');
        }

        /**
         * Validate email format
         */
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        /**
         * Validate form
         */
        function validateForm() {
            let isValid = true;
            hideMessage();

            // Validate email
            const email = emailInput.value.trim();
            if (!email) {
                showFieldError(emailInput, emailError, 'Email is required');
                isValid = false;
            } else if (!validateEmail(email)) {
                showFieldError(emailInput, emailError, 'Please enter a valid email address');
                isValid = false;
            } else {
                clearFieldError(emailInput, emailError);
                markFieldValid(emailInput);
            }

            return isValid;
        }

        /**
         * Set loading state
         */
        function setLoading(loading) {
            if (loading) {
                submitButton.disabled = true;
                submitButton.classList.add('loading');
                submitButton.textContent = 'Sending...';
            } else {
                submitButton.disabled = false;
                submitButton.classList.remove('loading');
                submitButton.textContent = 'Send Reset Instructions';
            }
        }

        /**
         * Show success state
         */
        function showSuccess(email) {
            // Hide form
            forgotPasswordForm.style.display = 'none';

            // Show success checkmark
            successCheckmark.classList.add('show');

            // Show success message after animation
            setTimeout(() => {
                submittedEmail.textContent = email;
                successMessage.style.display = 'block';
            }, 1000);
        }

        /**
         * Handle form submission
         */
        forgotPasswordForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Validate form
            if (!validateForm()) {
                return;
            }

            // Get form values
            const email = emailInput.value.trim();

            // Set loading state
            setLoading(true);
            hideMessage();

            // Simulate API call (password reset endpoint not implemented yet)
            setTimeout(() => {
                setLoading(false);

                // Show success message (always show success for security reasons)
                showSuccess(email);

                console.log('[ForgotPassword] Reset instructions sent to:', email);
            }, 1500);

            // TODO: Implement actual API call when backend endpoint is ready
            // try {
            //     const response = await fetch('/api/v1/auth/forgot-password', {
            //         method: 'POST',
            //         headers: {
            //             'Content-Type': 'application/json',
            //         },
            //         body: JSON.stringify({ email }),
            //     });
            //
            //     if (!response.ok) {
            //         throw new Error('Failed to send reset instructions');
            //     }
            //
            //     // Always show success for security (don't reveal if email exists)
            //     showSuccess(email);
            //
            // } catch (error) {
            //     showMessage('An error occurred. Please try again later.', 'error');
            //     setLoading(false);
            //     console.error('Forgot password error:', error);
            // }
        });

        /**
         * Clear field errors on input
         */
        emailInput.addEventListener('input', () => {
            if (emailInput.classList.contains('error')) {
                clearFieldError(emailInput, emailError);
            }
        });

        /**
         * Handle Enter key
         */
        emailInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                forgotPasswordForm.dispatchEvent(new Event('submit'));
            }
        });
    </script>

    <!-- Performance monitoring -->
    <script>
        window.addEventListener('load', () => {
            if (window.performance && window.performance.timing) {
                const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
                console.log(`[Performance] Forgot password page loaded in ${loadTime}ms`);
            }
        });
    </script>
</body>
</html>
